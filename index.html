<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BLACKOUT SHIELD ‚Äî Operation Command</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Oxanium:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#040a05;--panel:#08120a;--panel2:#0c1a0f;--border:#183020;
  --green:#00ff88;--gdim:#003322;
  --amber:#ffb300;--adim:#2a1d00;
  --red:#ff3344;--rdim:#1a0508;
  --blue:#00aaff;--cyan:#00ffee;
  --white:#c8e8d0;--dim:#3d6b4d;
  --mono:'Share Tech Mono',monospace;--main:'Oxanium',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--white);font-family:var(--mono);font-size:11px;overflow:hidden;height:100vh;width:100vw;}
.screen{display:none;width:100vw;height:100vh;}
.screen.active{display:flex;}

/* ‚îÄ‚îÄ TITLE ‚îÄ‚îÄ */
#title-screen{flex-direction:column;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at 50% 40%,#0a1e12,#040a05 70%);position:relative;overflow:hidden;}
.tgrid{position:absolute;inset:0;
  background-image:linear-gradient(rgba(0,255,136,.04) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,255,136,.04) 1px,transparent 1px);
  background-size:50px 50px;animation:gs 25s linear infinite;}
@keyframes gs{to{transform:translateY(50px);}}
.tscan{position:absolute;width:100%;height:3px;
  background:linear-gradient(90deg,transparent,var(--green),transparent);
  animation:sc 5s linear infinite;opacity:.2;}
@keyframes sc{from{top:-3px;}to{top:100%;}}
.tc{position:relative;z-index:1;text-align:center;}
.tbadge{font-size:10px;color:var(--amber);letter-spacing:6px;margin-bottom:18px;animation:pl 2s ease-in-out infinite;}
@keyframes pl{0%,100%{opacity:1;}50%{opacity:.4;}}
.tmain{font-family:var(--main);font-size:72px;font-weight:800;color:var(--green);
  text-shadow:0 0 40px rgba(0,255,136,.5);letter-spacing:4px;line-height:1;margin-bottom:6px;}
.tsub{font-family:var(--main);font-size:16px;font-weight:300;color:var(--dim);letter-spacing:8px;margin-bottom:48px;}
.tbtns{display:flex;gap:16px;justify-content:center;margin-bottom:36px;}
.tstats{display:flex;gap:48px;font-size:10px;color:var(--dim);letter-spacing:2px;}
.tstats span{color:var(--green);font-size:14px;display:block;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{font-family:var(--main);font-size:13px;font-weight:600;letter-spacing:3px;
  padding:12px 34px;background:transparent;cursor:pointer;transition:all .2s;
  clip-path:polygon(8px 0%,100% 0%,calc(100% - 8px) 100%,0% 100%);}
.btn-g{border:1px solid var(--green);color:var(--green);}
.btn-g:hover{background:var(--green);color:var(--bg);box-shadow:0 0 20px rgba(0,255,136,.4);}
.btn-a{border:1px solid var(--amber);color:var(--amber);}
.btn-a:hover{background:var(--amber);color:var(--bg);}
.btn-sm{font-family:var(--main);font-size:10px;letter-spacing:2px;padding:5px 12px;
  background:transparent;cursor:pointer;transition:all .2s;border:1px solid var(--dim);color:var(--dim);}
.btn-sm:hover{border-color:var(--white);color:var(--white);}

/* ‚îÄ‚îÄ HOW TO PLAY ‚îÄ‚îÄ */
#howto-screen{flex-direction:column;align-items:center;justify-content:flex-start;
  background:radial-gradient(ellipse at 50% 0%,#0a1e12,#040a05 60%);overflow-y:auto;padding:40px 20px;}
.hw{max-width:980px;width:100%;}
.hw-title{font-family:var(--main);font-size:28px;font-weight:800;color:var(--green);letter-spacing:4px;margin-bottom:4px;}
.hw-sub{color:var(--dim);font-size:10px;letter-spacing:3px;margin-bottom:24px;}
.hw-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:18px;}
.hw-card{background:var(--panel);border:1px solid var(--border);padding:16px;}
.hw-ct{font-family:var(--main);font-size:12px;font-weight:600;color:var(--amber);letter-spacing:2px;margin-bottom:8px;}
.hw-card p{line-height:1.7;font-size:11px;color:var(--white);}
.hw-card p+p{margin-top:5px;}
.hl{color:var(--green);}.wn{color:var(--red);}.tip{color:var(--amber);}
.hw-tbl{width:100%;border-collapse:collapse;margin-bottom:18px;}
.hw-tbl th{text-align:left;padding:6px 10px;color:var(--amber);font-size:9px;letter-spacing:2px;border-bottom:1px solid var(--border);}
.hw-tbl td{padding:6px 10px;border-bottom:1px solid rgba(24,48,32,.5);font-size:10px;}

/* ‚îÄ‚îÄ GAME ‚îÄ‚îÄ */
#game-screen{flex-direction:column;overflow:hidden;}

/* TOP BAR */
#topbar{height:46px;background:var(--panel);border-bottom:1px solid var(--border);
  display:flex;align-items:center;padding:0 14px;gap:16px;flex-shrink:0;z-index:10;}
.hb{display:flex;flex-direction:column;}
.hl2{font-size:8px;color:var(--dim);letter-spacing:2px;margin-bottom:1px;}
.hv{font-family:var(--main);font-size:15px;font-weight:600;color:var(--green);}
.hv.am{color:var(--amber);}.hv.rd{color:var(--red);}
.hsep{width:1px;height:30px;background:var(--border);}
#gname{font-family:var(--main);font-size:13px;font-weight:600;color:var(--green);letter-spacing:2px;}
.phase-badge{font-size:9px;letter-spacing:2px;padding:3px 10px;border:1px solid;font-family:var(--main);}
.ph-setup{border-color:var(--amber);color:var(--amber);background:var(--adim);}
.ph-combat{border-color:var(--red);color:var(--red);background:var(--rdim);animation:pl 1s ease-in-out infinite;}
.ph-end{border-color:var(--green);color:var(--green);background:var(--gdim);}

/* MAIN */
#gmain{flex:1;display:flex;overflow:hidden;}

/* LEFT PANEL */
#lpanel{width:220px;background:var(--panel);border-right:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;flex-shrink:0;}
.ptitle{font-family:var(--main);font-size:9px;font-weight:600;letter-spacing:3px;color:var(--dim);
  padding:8px 12px;border-bottom:1px solid var(--border);background:var(--panel2);
  display:flex;justify-content:space-between;align-items:center;}
.ptitle span{color:var(--green);}
#lpanel-scroll{flex:1;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--border) transparent;}
.sec-hdr{font-size:9px;letter-spacing:3px;color:var(--dim);padding:7px 12px 4px;
  border-bottom:1px solid var(--border);background:rgba(0,0,0,.2);}

.dac{padding:9px 12px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;}
.dac:hover{background:var(--panel2);}
.dac.sel{background:var(--gdim);border-left:2px solid var(--green);}
.dac-name{font-family:var(--main);font-size:12px;font-weight:600;color:var(--white);margin-bottom:2px;}
.badge{display:inline-block;font-size:8px;padding:1px 6px;letter-spacing:1px;margin-bottom:3px;}
.b-pat{background:rgba(255,51,68,.15);color:var(--red);border:1px solid var(--red);}
.b-f16{background:rgba(0,170,255,.15);color:var(--blue);border:1px solid var(--blue);}
.b-mig{background:rgba(255,179,0,.15);color:var(--amber);border:1px solid var(--amber);}
.b-drone{background:rgba(0,255,136,.15);color:var(--green);border:1px solid var(--green);}
.b-rad{background:rgba(0,255,238,.15);color:var(--cyan);border:1px solid var(--cyan);}
.dac-info{font-size:9px;color:var(--dim);line-height:1.5;}
.dac-info .v{color:var(--white);}
.dac-placed{font-size:9px;color:var(--green);margin-top:2px;}

#budget-bar{padding:8px 12px;border-top:1px solid var(--border);background:var(--panel2);flex-shrink:0;}
.bb-lbl{font-size:9px;color:var(--dim);letter-spacing:2px;margin-bottom:4px;display:flex;justify-content:space-between;}
.bb-lbl span{color:var(--amber);}
.bb-track{height:5px;background:var(--border);}
.bb-fill{height:100%;background:var(--green);transition:width .3s;}
.bb-fill.warn{background:var(--amber);}
.bb-fill.over{background:var(--red);}
#launch-btn{margin:8px 12px;padding:9px;background:transparent;border:1px solid var(--green);
  color:var(--green);font-family:var(--main);font-size:11px;font-weight:600;letter-spacing:3px;
  cursor:pointer;transition:all .2s;display:none;}
#launch-btn:hover{background:var(--green);color:var(--bg);}
#launch-btn.show{display:block;}

/* MAP */
#mapwrap{flex:1;position:relative;overflow:hidden;background:#020905;}
#map-canvas{display:block;}
.map-tip{position:absolute;top:10px;left:50%;transform:translateX(-50%);
  background:rgba(4,10,5,.92);border:1px solid var(--amber);color:var(--amber);
  font-size:10px;letter-spacing:2px;padding:5px 14px;pointer-events:none;z-index:5;display:none;}
.map-tip.show{display:block;}
#wave-banner{position:absolute;inset:0;display:none;align-items:center;justify-content:center;
  background:rgba(4,10,5,.75);z-index:20;}
#wave-banner.show{display:flex;}
.wb-text{font-family:var(--main);font-size:40px;font-weight:800;letter-spacing:8px;
  color:var(--red);animation:pl .5s ease-in-out infinite;}

/* RIGHT PANEL */
#rpanel{width:230px;background:var(--panel);border-left:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;flex-shrink:0;}
#rpanel-scroll{flex:1;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--border) transparent;}

.sc{padding:10px 12px;border-bottom:1px solid var(--border);}
.sc-name{font-family:var(--main);font-size:12px;font-weight:600;color:var(--white);margin-bottom:2px;}
.sc-badge{display:inline-block;font-size:8px;padding:1px 6px;letter-spacing:1px;margin-bottom:3px;}
.b-kinzhal{background:rgba(255,51,68,.15);color:var(--red);border:1px solid var(--red);}
.b-iskander{background:rgba(255,120,0,.15);color:#ff7800;border:1px solid #ff7800;}
.b-cruise{background:rgba(255,179,0,.15);color:var(--amber);border:1px solid var(--amber);}
.b-shahed{background:rgba(100,200,100,.15);color:#64c864;border:1px solid #64c864;}
.sc-info{font-size:9px;color:var(--dim);line-height:1.5;margin-bottom:6px;}
.sc-info .v{color:var(--white);}
.sc-ctrl{display:flex;flex-direction:column;gap:4px;}
.sc-ctrl label{font-size:9px;color:var(--dim);letter-spacing:1px;}
.sc-ctrl select,.sc-ctrl input[type=number]{
  width:100%;background:var(--panel2);color:var(--white);border:1px solid var(--border);
  padding:4px 6px;font-family:var(--mono);font-size:10px;margin-top:2px;}
.sc-qty{display:flex;align-items:center;gap:8px;}
.sc-qty input{width:55px!important;text-align:center;}
.sc-add{margin-top:5px;width:100%;padding:5px;background:var(--rdim);border:1px solid var(--red);
  color:var(--red);font-family:var(--mono);font-size:9px;letter-spacing:2px;cursor:pointer;transition:all .2s;}
.sc-add:hover{background:var(--red);color:var(--bg);}

#strike-budget-bar{padding:8px 12px;border-top:1px solid var(--border);background:var(--panel2);flex-shrink:0;}

/* THREAT QUEUE */
.tq-item{padding:7px 12px;border-bottom:1px solid var(--border);}
.tq-item.tq-hi{border-left:3px solid var(--red);}
.tq-item.tq-md{border-left:3px solid var(--amber);}
.tq-item.tq-lo{border-left:3px solid var(--green);}
.tq-item.tq-done{opacity:.3;}
.tq-name{font-family:var(--main);font-size:11px;font-weight:600;color:var(--white);margin-bottom:1px;}
.tq-tgt{font-size:9px;color:var(--amber);margin-bottom:1px;}
.tq-eta{font-family:var(--main);font-size:13px;font-weight:600;color:var(--red);}
.tq-eta.mid{color:var(--amber);}.tq-eta.far{color:var(--green);}
.tq-st{font-size:9px;letter-spacing:1px;margin-top:1px;}
.st-det{color:var(--blue);}.st-eng{color:var(--amber);}.st-hit{color:var(--green);}
.st-mis{color:var(--amber);}.st-imp{color:var(--red);font-weight:bold;}

/* BOTTOM LOG */
#blog{height:70px;background:var(--panel2);border-top:1px solid var(--border);
  overflow-y:auto;padding:5px 12px;scrollbar-width:thin;scrollbar-color:var(--border) transparent;flex-shrink:0;}
.log-e{font-size:10px;padding:1px 0;line-height:1.4;}
.lt{color:var(--dim);margin-right:6px;}
.lh{color:var(--green);}.lm{color:var(--amber);}.li{color:var(--red);}.ld{color:var(--blue);}.ln{color:var(--white);}.lrd{color:var(--red);}

/* RESULT */
#result-screen{flex-direction:column;align-items:center;justify-content:center;
  background:radial-gradient(ellipse at 50% 30%,#0a1e12,#040a05 70%);overflow-y:auto;padding:40px 20px;}
.res-wrap{max-width:860px;width:100%;text-align:center;}
.res-title{font-family:var(--main);font-size:13px;font-weight:300;color:var(--dim);letter-spacing:6px;margin-bottom:6px;}
.res-rank{font-family:var(--main);font-size:96px;font-weight:800;line-height:1;margin-bottom:4px;}
.rk-s{color:var(--green);text-shadow:0 0 60px rgba(0,255,136,.5);}
.rk-a{color:var(--amber);}
.rk-b{color:var(--blue);}
.rk-f{color:var(--red);}
.res-sub{font-size:11px;color:var(--dim);letter-spacing:4px;margin-bottom:28px;}
.res-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:16px;}
.res-card{background:var(--panel);border:1px solid var(--border);padding:14px;text-align:left;}
.rc-lbl{font-size:9px;color:var(--dim);letter-spacing:2px;margin-bottom:5px;}
.rc-val{font-family:var(--main);font-size:20px;font-weight:600;color:var(--white);}
.rc-val.good{color:var(--green);}.rc-val.bad{color:var(--red);}.rc-val.ok{color:var(--amber);}
.res-cmp{background:var(--panel);border:1px solid var(--border);padding:18px;margin-bottom:18px;text-align:left;}
.rcp-title{font-family:var(--main);font-size:12px;font-weight:600;color:var(--amber);letter-spacing:2px;margin-bottom:12px;}
.rcp-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:11px;}
.rcp-row:last-child{border-bottom:none;padding-top:10px;}
.rcp-lbl{color:var(--dim);}
.rcp-ua{color:var(--green);}.rcp-ru{color:var(--red);}
.res-btns{display:flex;gap:12px;justify-content:center;}

::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border);}
</style>
</head>
<body>

<!-- TITLE -->
<div id="title-screen" class="screen active">
  <div class="tgrid"></div><div class="tscan"></div>
  <div class="tc">
    <div class="tbadge">‚ö° CLASSIFIED // UKRAINE COMBINED ARMS SIMULATOR ‚ö°</div>
    <div class="tmain">BLACKOUT<br>SHIELD</div>
    <div class="tsub">DEFEND. DETECT. STRIKE.</div>
    <div class="tbtns">
      <button class="btn btn-g" onclick="initGame()">‚ñ∂ START OPERATION</button>
      <button class="btn btn-a" onclick="showScreen('howto-screen')">? HOW TO PLAY</button>
    </div>
    <div class="tstats">
      <div>MAP AREA<span>600√ó600 KM</span></div>
      <div>DEFEND<span>5 TARGETS</span></div>
      <div>STRIKE<span>4 WEAPONS</span></div>
      <div>AI AUTO-INTERCEPT<span>CHEAPEST FIRST</span></div>
    </div>
  </div>
</div>

<!-- HOW TO PLAY -->
<div id="howto-screen" class="screen">
  <div class="hw">
    <div class="hw-title">HOW TO PLAY</div>
    <div class="hw-sub">SIMPLE ENOUGH FOR A 10-YEAR-OLD ‚Äî DEEP ENOUGH FOR A GENERAL</div>
    <div class="hw-grid">
      <div class="hw-card">
        <div class="hw-ct">üó∫Ô∏è THE MAP</div>
        <p>You command Ukraine's air defense over a <span class="hl">600√ó600 km</span> area. Five power stations are spread across the country. Enemies fly in from <span class="hl">North, East, and South</span>.</p>
        <p class="tip">‚òÖ Targets are far apart ‚Äî one radar can't cover all of them!</p>
      </div>
      <div class="hw-card">
        <div class="hw-ct">üõ°Ô∏è LEFT PANEL ‚Äî YOU DEFEND</div>
        <p>Click an asset in the left panel, then <span class="hl">click the map</span> to place it. Place <span class="hl">radars first</span> ‚Äî without them you're blind. Then place Patriot batteries, jets, and drone hubs near targets.</p>
        <p><span class="wn">Watch the defense budget bar!</span></p>
      </div>
      <div class="hw-card">
        <div class="hw-ct">‚öîÔ∏è RIGHT PANEL ‚Äî YOU STRIKE</div>
        <p>You also play as the attacker! Pick a weapon, choose an <span class="hl">axis</span> (direction), pick a <span class="hl">target</span>, set quantity, then click <span class="hl">ADD TO PLAN</span>. Launch when ready.</p>
        <p class="tip">Kinzhals are hardest to stop. Shaheds are cheapest!</p>
      </div>
      <div class="hw-card">
        <div class="hw-ct">ü§ñ AUTO-INTERCEPT AI</div>
        <p>Once combat starts, <span class="hl">the game automatically</span> picks the cheapest defense weapon that can hit each threat.</p>
        <p><span class="wn">No radar nearby = the threat flies through undetected!</span> Place radars on the flight paths between enemy axes and your targets.</p>
      </div>
      <div class="hw-card">
        <div class="hw-ct">üí∞ THE COST GAME</div>
        <p>At the end you see: what Russia spent on strikes vs what Ukraine spent defending. If Ukraine spent <span class="hl">less than Russia</span> AND protected targets ‚Üí efficient victory.</p>
        <p><span class="wn">A $4M Patriot shooting a $30K Shahed = bad economics!</span></p>
      </div>
      <div class="hw-card">
        <div class="hw-ct">üèÜ HOW TO WIN</div>
        <p>Protect at least <span class="hl">3 of 5</span> targets. Stay under <span class="hl">$150M</span> defense budget. Intercept more than 70% of threats.</p>
        <p><span class="hl">S-Rank:</span> 4+ targets alive, under budget, defense cost &lt; enemy strike cost.</p>
        <p><span class="wn">F-Rank:</span> 3+ targets destroyed = blackout.</p>
      </div>
    </div>
    <table class="hw-tbl">
      <thead><tr><th>SYSTEM</th><th>TYPE</th><th>BEST AGAINST</th><th>COST/SHOT</th><th>RANGE</th><th>HIT %</th></tr></thead>
      <tbody>
        <tr><td>üì° Radar</td><td>Sensor</td><td>Detection (required!)</td><td>FREE</td><td>100 km</td><td>‚Äî</td></tr>
        <tr><td>üõ°Ô∏è Patriot PAC-3</td><td>Defense</td><td>Kinzhal, Iskander</td><td>$4M</td><td>160 km</td><td>96% / 88%</td></tr>
        <tr><td>‚úàÔ∏è F-16 AIM-120D</td><td>Defense</td><td>Cruise missiles, Iskander-K</td><td>$1M</td><td>160 km</td><td>85%</td></tr>
        <tr><td>üõ©Ô∏è MiG-29 R-77</td><td>Defense</td><td>Cruise missiles</td><td>$500K</td><td>110 km</td><td>75%</td></tr>
        <tr><td>üöÅ Interceptor Drones</td><td>Defense</td><td>Shaheds only</td><td>$2K</td><td>20 km</td><td>78%</td></tr>
        <tr><td>‚òÑÔ∏è Kinzhal</td><td>Strike</td><td>Any target ‚Äî very fast</td><td>$15M</td><td>‚Äî</td><td>Hard to stop</td></tr>
        <tr><td>üöÄ Iskander-M</td><td>Strike</td><td>Any target ‚Äî ballistic</td><td>$3M</td><td>‚Äî</td><td>Moderate</td></tr>
        <tr><td>‚úàÔ∏è Cruise Missile</td><td>Strike</td><td>Infrastructure</td><td>$1M</td><td>‚Äî</td><td>Moderate</td></tr>
        <tr><td>üî¥ Shahed-136</td><td>Strike</td><td>Swarm / exhaust defense</td><td>$30K</td><td>‚Äî</td><td>Easy to stop</td></tr>
      </tbody>
    </table>
    <div style="text-align:center;display:flex;gap:12px;justify-content:center;">
      <button class="btn btn-g" onclick="initGame()">‚ñ∂ START OPERATION</button>
      <button class="btn btn-a" onclick="showScreen('title-screen')">‚Üê BACK</button>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
  <div id="topbar">
    <div id="gname">OPERATION BLACKOUT SHIELD</div>
    <div class="phase-badge ph-setup" id="phase-badge">SETUP PHASE</div>
    <div class="hsep"></div>
    <div class="hb"><div class="hl2">CLOCK</div><div class="hv" id="hv-clock">00:00</div></div>
    <div class="hsep"></div>
    <div class="hb"><div class="hl2">DEF BUDGET LEFT</div><div class="hv am" id="hv-defbud">$150M</div></div>
    <div class="hsep"></div>
    <div class="hb"><div class="hl2">STRIKE COST</div><div class="hv rd" id="hv-strbud">$0</div></div>
    <div class="hsep"></div>
    <div class="hb"><div class="hl2">SCORE</div><div class="hv" id="hv-score">0</div></div>
    <div class="hsep"></div>
    <div class="hb"><div class="hl2">TARGETS SAFE</div><div class="hv" id="hv-targets">5 / 5</div></div>
    <div style="margin-left:auto;display:flex;gap:8px;">
      <button class="btn-sm" onclick="showScreen('howto-screen')">? HELP</button>
      <button class="btn-sm" onclick="if(confirm('Abort?'))showScreen('title-screen')">‚úï ABORT</button>
    </div>
  </div>

  <div id="gmain">
    <!-- LEFT ‚Äî DEFENSE -->
    <div id="lpanel">
      <div class="ptitle">üõ°Ô∏è DEFENSE SETUP <span id="lp-hint">CLICK ASSET ‚Üí CLICK MAP</span></div>
      <div id="lpanel-scroll">
        <div class="sec-hdr">üì° RADARS ‚Äî PLACE FIRST</div>
        <div class="dac" id="dac-radar" onclick="selectTool('radar')">
          <div class="dac-name">üì° Radar Unit</div>
          <span class="badge b-rad">SENSOR</span>
          <div class="dac-info">Detection: <span class="v">100 km radius</span> | Cost: <span class="v">FREE</span><br>
            Available: <span class="v" id="radar-avail">9</span> | Placed: <span class="v" id="radar-placed">0</span></div>
        </div>

        <div class="sec-hdr">üõ°Ô∏è AIR DEFENSE WEAPONS</div>
        <div class="dac" id="dac-patriot" onclick="selectTool('patriot')">
          <div class="dac-name">üõ°Ô∏è Patriot Battery</div>
          <span class="badge b-pat">PAC-3 / PAC-2</span>
          <div class="dac-info">Range: <span class="v">160 km</span> | Shot: <span class="v">$4M</span><br>
            vs Kinzhal: <span class="v">96%</span> | vs Iskander: <span class="v">88%</span><br>
            Available: <span class="v" id="pat-avail">2</span></div>
          <div class="dac-placed" id="pat-placed"></div>
        </div>
        <div class="dac" id="dac-f16" onclick="selectTool('f16')">
          <div class="dac-name">‚úàÔ∏è F-16 Squadron</div>
          <span class="badge b-f16">AIM-120D</span>
          <div class="dac-info">Range: <span class="v">160 km</span> | Shot: <span class="v">$1M</span><br>
            vs Cruise: <span class="v">85%</span> | vs Iskander-K: <span class="v">80%</span><br>
            Available: <span class="v" id="f16-avail">4</span></div>
          <div class="dac-placed" id="f16-placed"></div>
        </div>
        <div class="dac" id="dac-mig" onclick="selectTool('mig')">
          <div class="dac-name">üõ©Ô∏è MiG-29 Squadron</div>
          <span class="badge b-mig">R-77</span>
          <div class="dac-info">Range: <span class="v">110 km</span> | Shot: <span class="v">$500K</span><br>
            vs Cruise: <span class="v">75%</span> | vs Iskander-K: <span class="v">65%</span><br>
            Available: <span class="v" id="mig-avail">4</span></div>
          <div class="dac-placed" id="mig-placed"></div>
        </div>
        <div class="dac" id="dac-drone" onclick="selectTool('drone')">
          <div class="dac-name">üöÅ Drone Hub</div>
          <span class="badge b-drone">INTERCEPTOR</span>
          <div class="dac-info">Range: <span class="v">20 km</span> | Shot: <span class="v">$2K</span><br>
            vs Shahed: <span class="v">78%</span> | Pool: <span class="v">500 drones</span><br>
            Available: <span class="v" id="dh-avail">5</span></div>
          <div class="dac-placed" id="dh-placed"></div>
        </div>

        <div class="sec-hdr">‚ö† INCOMING THREATS</div>
        <div id="threat-queue">
          <div style="padding:14px;color:var(--dim);font-size:10px;text-align:center;">No threats detected yet.</div>
        </div>
      </div>
      <div id="budget-bar">
        <div class="bb-lbl">DEFENSE BUDGET <span id="bb-spent">$0 / $150M used</span></div>
        <div class="bb-track"><div class="bb-fill" id="bb-fill" style="width:100%"></div></div>
      </div>
      <button id="launch-btn" class="show" onclick="startCombat()">‚ö° LAUNCH OPERATION</button>
    </div>

    <!-- MAP -->
    <div id="mapwrap">
      <canvas id="map-canvas"></canvas>
      <div class="map-tip show" id="map-tip">SELECT AN ASSET FROM LEFT PANEL, THEN CLICK MAP</div>
      <div id="wave-banner"><div class="wb-text" id="wb-text">WAVE INCOMING</div></div>
    </div>

    <!-- RIGHT ‚Äî STRIKE -->
    <div id="rpanel">
      <div class="ptitle">‚öîÔ∏è STRIKE COMMAND <span id="rp-hint">PLAN YOUR STRIKES</span></div>
      <div id="rpanel-scroll">
        <div class="sec-hdr">CHOOSE WEAPON & CONFIGURE</div>

        <div class="sc">
          <div class="sc-name">‚òÑÔ∏è Kinzhal</div>
          <span class="sc-badge b-kinzhal">HYPERSONIC MACH 10</span>
          <div class="sc-info">Cost: <span class="v">$15M/unit</span> | Very hard to intercept<br>Only Patriot has a chance</div>
          <div class="sc-ctrl">
            <label>FROM AXIS:<select id="kinzhal-axis"><option value="north">North ‚Äî Belarus</option><option value="east">East ‚Äî Russia</option><option value="south">South ‚Äî Crimea</option></select></label>
            <label>TARGET:<select id="kinzhal-target"><option value="0">T1: Kyiv Plant</option><option value="1">T2: Substation</option><option value="2">T3: Trypillya</option><option value="3">T4: Boryspil</option><option value="4">T5: Hostomel</option></select></label>
            <div class="sc-qty"><label>QTY: <input type="number" id="kinzhal-qty" value="2" min="1" max="12"></label></div>
            <button class="sc-add" onclick="queueStrike('kinzhal')">+ ADD TO STRIKE PLAN</button>
          </div>
        </div>

        <div class="sc">
          <div class="sc-name">üöÄ Iskander-M</div>
          <span class="sc-badge b-iskander">BALLISTIC MACH 7</span>
          <div class="sc-info">Cost: <span class="v">$3M/unit</span> | Ballistic arc ‚Äî Patriot needed</div>
          <div class="sc-ctrl">
            <label>FROM AXIS:<select id="iskander-axis"><option value="north">North</option><option value="east">East</option><option value="south">South</option></select></label>
            <label>TARGET:<select id="iskander-target"><option value="0">T1: Kyiv Plant</option><option value="1">T2: Substation</option><option value="2">T3: Trypillya</option><option value="3">T4: Boryspil</option><option value="4">T5: Hostomel</option></select></label>
            <div class="sc-qty"><label>QTY: <input type="number" id="iskander-qty" value="3" min="1" max="15"></label></div>
            <button class="sc-add" onclick="queueStrike('iskander')">+ ADD TO STRIKE PLAN</button>
          </div>
        </div>

        <div class="sc">
          <div class="sc-name">‚úàÔ∏è Cruise Missile</div>
          <span class="sc-badge b-cruise">LOW ALTITUDE MACH 0.8</span>
          <div class="sc-info">Cost: <span class="v">$1M/unit</span> | Slow but radar-evading at low alt</div>
          <div class="sc-ctrl">
            <label>FROM AXIS:<select id="cruise-axis"><option value="north">North</option><option value="east">East</option><option value="south">South</option></select></label>
            <label>TARGET:<select id="cruise-target"><option value="0">T1: Kyiv Plant</option><option value="1">T2: Substation</option><option value="2">T3: Trypillya</option><option value="3">T4: Boryspil</option><option value="4">T5: Hostomel</option></select></label>
            <div class="sc-qty"><label>QTY: <input type="number" id="cruise-qty" value="5" min="1" max="50"></label></div>
            <button class="sc-add" onclick="queueStrike('cruise')">+ ADD TO STRIKE PLAN</button>
          </div>
        </div>

        <div class="sc">
          <div class="sc-name">üî¥ Shahed-136 Swarm</div>
          <span class="sc-badge b-shahed">KAMIKAZE DRONE</span>
          <div class="sc-info">Cost: <span class="v">$30K/unit</span> | Cheap ‚Äî use in mass to exhaust defenses</div>
          <div class="sc-ctrl">
            <label>FROM AXIS:<select id="shahed-axis"><option value="north">North</option><option value="east">East</option><option value="south">South</option></select></label>
            <label>TARGET:<select id="shahed-target"><option value="0">T1: Kyiv Plant</option><option value="1">T2: Substation</option><option value="2">T3: Trypillya</option><option value="3">T4: Boryspil</option><option value="4">T5: Hostomel</option></select></label>
            <div class="sc-qty"><label>QTY: <input type="number" id="shahed-qty" value="20" min="1" max="200"></label></div>
            <button class="sc-add" onclick="queueStrike('shahed')">+ ADD TO STRIKE PLAN</button>
          </div>
        </div>

        <div class="sec-hdr">üìã STRIKE PLAN</div>
        <div id="strike-plan-list">
          <div style="padding:12px;color:var(--dim);font-size:10px;text-align:center;">No strikes planned yet.</div>
        </div>
      </div>
      <div id="strike-budget-bar">
        <div class="bb-lbl">TOTAL STRIKE COST <span id="sb-spent" style="color:var(--red);">$0</span></div>
        <div class="bb-track"><div class="bb-fill" id="sb-fill" style="width:0%;background:var(--red);"></div></div>
      </div>
    </div>
  </div>

  <div id="blog"></div>
</div>

<!-- RESULT -->
<div id="result-screen" class="screen">
  <div class="res-wrap">
    <div class="res-title">OPERATION COMPLETE</div>
    <div class="res-rank" id="res-rank">S</div>
    <div class="res-sub" id="res-sub">BLACKOUT PREVENTED</div>
    <div class="res-grid" id="res-grid"></div>
    <div class="res-cmp" id="res-cmp"></div>
    <div class="res-btns">
      <button class="btn btn-g" onclick="initGame()">‚ñ∂ PLAY AGAIN</button>
      <button class="btn btn-a" onclick="showScreen('title-screen')">‚Üê MAIN MENU</button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DEF_BUDGET = 150e6;

// Targets spread wide across the full 600√ó600 km map
// x/y as fraction 0..1 of canvas dimensions
const TARGETS = [
  { name:'Kyiv Thermal Plant',   short:'T1: Kyiv Plant',  x:0.45, y:0.15 },
  { name:'Vokzalna Substation',  short:'T2: Substation',  x:0.60, y:0.30 },
  { name:'Trypillya Plant',      short:'T3: Trypillya',   x:0.28, y:0.78 },
  { name:'Boryspil Energy Hub',  short:'T4: Boryspil',    x:0.82, y:0.50 },
  { name:'Hostomel Aerodrome',   short:'T5: Hostomel',    x:0.15, y:0.22 },
];

const AXES = {
  north: { x:0.48, y:-0.05, label:'NORTH ‚Äî BELARUS', col:'#ff3344' },
  east:  { x:1.05, y:0.48,  label:'EAST ‚Äî RUSSIA',   col:'#ff7800' },
  south: { x:0.50, y:1.05,  label:'SOUTH ‚Äî CRIMEA',  col:'#ffb300' },
};

const DEF_ASSETS = {
  radar:   { name:'Radar',            icon:'üì°', maxPlace:9,  range:100, costShot:0,      hitProb:{}, isRadar:true },
  patriot: { name:'Patriot Battery',  icon:'üõ°Ô∏è', maxPlace:2,  range:160, costShot:4e6,
    hitProb:{ kinzhal:0.96, iskander:0.88, cruise:0.45, shahed:0.30 } },
  f16:     { name:'F-16 Squadron',    icon:'‚úàÔ∏è', maxPlace:4,  range:160, costShot:1e6,
    hitProb:{ kinzhal:0.35, iskander:0.50, cruise:0.85, shahed:0.40 } },
  mig:     { name:'MiG-29 Squadron',  icon:'üõ©Ô∏è', maxPlace:4,  range:110, costShot:500000,
    hitProb:{ kinzhal:0.08, iskander:0.38, cruise:0.75, shahed:0.30 } },
  drone:   { name:'Drone Hub',        icon:'üöÅ', maxPlace:5,  range:20,  costShot:2000,
    hitProb:{ kinzhal:0.0,  iskander:0.0,  cruise:0.05, shahed:0.78 } },
};

// Speed in map-units per TICK (1 tick = 1 second game clock)
// Map = 600km. 1 map unit = 600km. So speed = km/h / 600 / 3600 * tickInterval(ms)/1000
// Tick is every 1s of game time. We want visible travel so speeds are slightly dramatized.
// Kinzhal real: 12,000 km/h -> crosses 600km in ~3min. We scale to ~20 game-ticks.
const STRIKE_WEAPONS = {
  kinzhal:  { name:'Kinzhal',        icon:'‚òÑÔ∏è', costUnit:15e6,  speedPerTick:0.030, col:'#ff3344', points:1000 },
  iskander: { name:'Iskander-M',     icon:'üöÄ', costUnit:3e6,   speedPerTick:0.022, col:'#ff7800', points:500  },
  cruise:   { name:'Cruise Missile', icon:'‚úàÔ∏è', costUnit:1e6,   speedPerTick:0.008, col:'#ffb300', points:150  },
  shahed:   { name:'Shahed-136',     icon:'üî¥', costUnit:30000, speedPerTick:0.003, col:'#64c864', points:50   },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let canvas, ctx, CW, CH;
let gamePhase = 'setup';
let clockSecs = 0;
let clockInterval = null;
let animHandle = null;
let selectedTool = null;
let hoverXY = null;

let placedRadars  = [];
let placedAssets  = [];
let assetCounts   = { patriot:0, f16:0, mig:0, drone:0 };
let radarCount    = 0;

let strikePlan    = [];
let strikeCostTotal = 0;

let activeBandits = [];
let banditSeq     = 0;
let explosions    = [];
let missileLines  = [];

let score         = 0;
let defCostFired  = 0;
let targetsAlive  = [true,true,true,true,true];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SCREENS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function initGame() {
  showScreen('game-screen');
  resetAll();
  setTimeout(() => {
    setupCanvas();
    drawMap();
  }, 60);
}

function resetAll() {
  // Stop any running loops
  clearInterval(clockInterval); clockInterval = null;
  if(animHandle) { cancelAnimationFrame(animHandle); animHandle = null; }

  gamePhase = 'setup';
  clockSecs = 0;
  selectedTool = null;
  hoverXY = null;
  placedRadars = [];
  placedAssets = [];
  assetCounts = { patriot:0, f16:0, mig:0, drone:0 };
  radarCount = 0;
  strikePlan = [];
  strikeCostTotal = 0;
  activeBandits = [];
  banditSeq = 0;
  explosions = [];
  missileLines = [];
  score = 0;
  defCostFired = 0;
  targetsAlive = [true,true,true,true,true];

  // UI resets
  setText('hv-clock','00:00');
  setText('hv-defbud','$150M');
  setText('hv-strbud','$0');
  setText('hv-score','0');
  setText('hv-targets','5 / 5');
  setClass('hv-defbud','hv am');
  setPhaseBadge('setup');
  setText('bb-spent','$0 / $150M used');
  setStyle('bb-fill','width','100%');
  setClass('bb-fill','bb-fill');
  setText('sb-spent','$0');
  setStyle('sb-fill','width','0%');
  setText('radar-avail','9'); setText('radar-placed','0');
  setText('pat-avail','2');   setText('pat-placed','');
  setText('f16-avail','4');   setText('f16-placed','');
  setText('mig-avail','4');   setText('mig-placed','');
  setText('dh-avail','5');    setText('dh-placed','');
  show('launch-btn', true);
  show('map-tip', true);
  setText('map-tip','SELECT AN ASSET FROM LEFT PANEL, THEN CLICK MAP');
  setText('lp-hint','CLICK ASSET ‚Üí CLICK MAP');
  setText('rp-hint','PLAN YOUR STRIKES');
  document.getElementById('threat-queue').innerHTML =
    '<div style="padding:14px;color:var(--dim);font-size:10px;text-align:center;">No threats detected yet.</div>';
  document.getElementById('strike-plan-list').innerHTML =
    '<div style="padding:12px;color:var(--dim);font-size:10px;text-align:center;">No strikes planned yet.</div>';
  document.querySelectorAll('.dac').forEach(c => c.classList.remove('sel'));
  clearLog();
  addLog('ln','Operation initialized. Place defense assets on map, plan your strikes, then launch.');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CANVAS SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setupCanvas() {
  canvas = document.getElementById('map-canvas');
  const wrap = document.getElementById('mapwrap');
  CW = wrap.clientWidth;
  CH = wrap.clientHeight;
  canvas.width = CW;
  canvas.height = CH;
  ctx = canvas.getContext('2d');
  canvas.onclick = onMapClick;
  canvas.onmousemove = onMapHover;
}

function onMapHover(e) {
  const r = canvas.getBoundingClientRect();
  hoverXY = { x:(e.clientX-r.left)/CW, y:(e.clientY-r.top)/CH };
  if(gamePhase === 'setup') drawMap();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOOL SELECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function selectTool(type) {
  if(gamePhase !== 'setup') return;
  selectedTool = type;
  document.querySelectorAll('.dac').forEach(c => c.classList.remove('sel'));
  document.getElementById('dac-'+type).classList.add('sel');
  const tip = document.getElementById('map-tip');
  tip.classList.add('show');
  if(type === 'radar')
    tip.textContent = 'üì° CLICK MAP TO PLACE RADAR ‚Äî 100 km detection radius shown';
  else
    tip.textContent = DEF_ASSETS[type].icon + ' CLICK MAP TO PLACE ' + DEF_ASSETS[type].name.toUpperCase();
  drawMap();
}

function onMapClick(e) {
  if(gamePhase !== 'setup' || !selectedTool) return;
  const r = canvas.getBoundingClientRect();
  const mx = (e.clientX-r.left)/CW;
  const my = (e.clientY-r.top)/CH;

  if(selectedTool === 'radar') {
    if(radarCount >= 9) { addLog('lm','‚ö† All 9 radars already placed!'); return; }
    placedRadars.push({x:mx, y:my});
    radarCount++;
    setText('radar-avail', String(9-radarCount));
    setText('radar-placed', radarCount + ' placed');
    addLog('ld','üì° Radar placed at ['+Math.round(mx*600)+'km, '+Math.round(my*600)+'km]');
  } else {
    const def = DEF_ASSETS[selectedTool];
    if(assetCounts[selectedTool] >= def.maxPlace) {
      addLog('lm','‚ö† Max '+def.maxPlace+' '+def.name+' already placed!'); return;
    }
    placedAssets.push({
      type: selectedTool, x: mx, y: my,
      icon: def.icon, name: def.name,
      range: def.range, costShot: def.costShot,
      hitProb: Object.assign({}, def.hitProb),
      ammo: selectedTool==='drone' ? 500 : 30,
    });
    assetCounts[selectedTool]++;
    const avKey = {patriot:'pat-avail',f16:'f16-avail',mig:'mig-avail',drone:'dh-avail'}[selectedTool];
    const plKey = {patriot:'pat-placed',f16:'f16-placed',mig:'mig-placed',drone:'dh-placed'}[selectedTool];
    setText(avKey, String(def.maxPlace - assetCounts[selectedTool]));
    setText(plKey, '‚úì '+assetCounts[selectedTool]+' placed');
    addLog('ln', def.icon+' '+def.name+' placed at ['+Math.round(mx*600)+'km, '+Math.round(my*600)+'km]');
  }

  // Deselect
  selectedTool = null;
  document.querySelectorAll('.dac').forEach(c => c.classList.remove('sel'));
  document.getElementById('map-tip').classList.remove('show');
  drawMap();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STRIKE PLANNING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function queueStrike(type) {
  if(gamePhase !== 'setup') { addLog('lm','‚ö† Cannot change strike plan after launch!'); return; }
  const axis    = document.getElementById(type+'-axis').value;
  const tgtIdx  = parseInt(document.getElementById(type+'-target').value);
  const qty     = Math.max(1, parseInt(document.getElementById(type+'-qty').value)||1);
  const w       = STRIKE_WEAPONS[type];
  const cost    = w.costUnit * qty;
  strikeCostTotal += cost;
  strikePlan.push({ type, axis, tgtIdx, qty, cost });
  renderStrikePlan();
  setText('sb-spent', '$'+fmt(strikeCostTotal));
  setStyle('sb-fill','width', Math.min(100,(strikeCostTotal/200e6)*100)+'%');
  setText('hv-strbud','$'+fmt(strikeCostTotal));
  addLog('lrd','‚öîÔ∏è '+qty+'√ó '+w.name+' from '+axis.toUpperCase()+' ‚Üí '+TARGETS[tgtIdx].short+' ($'+fmt(cost)+')');
}

function removeStrike(idx) {
  if(gamePhase !== 'setup') return;
  strikeCostTotal -= strikePlan[idx].cost;
  strikePlan.splice(idx,1);
  renderStrikePlan();
  setText('sb-spent','$'+fmt(strikeCostTotal));
  setStyle('sb-fill','width', Math.min(100,(strikeCostTotal/200e6)*100)+'%');
  setText('hv-strbud','$'+fmt(strikeCostTotal));
}

function renderStrikePlan() {
  const el = document.getElementById('strike-plan-list');
  if(!strikePlan.length) {
    el.innerHTML='<div style="padding:12px;color:var(--dim);font-size:10px;text-align:center;">No strikes planned yet.</div>';
    return;
  }
  el.innerHTML = strikePlan.map((s,i) => {
    const w = STRIKE_WEAPONS[s.type];
    return '<div style="padding:8px 12px;border-bottom:1px solid var(--border);font-size:10px;">'
      +'<div style="display:flex;justify-content:space-between;">'
      +'<span style="color:var(--white);font-family:var(--main);font-weight:600;">'+w.icon+' '+s.qty+'√ó '+w.name+'</span>'
      +'<button onclick="removeStrike('+i+')" style="background:none;border:none;color:var(--dim);cursor:pointer;font-size:12px;">‚úï</button>'
      +'</div>'
      +'<div style="color:var(--dim);">'+s.axis.toUpperCase()+' ‚Üí '+TARGETS[s.tgtIdx].short+'</div>'
      +'<div style="color:var(--red);">$'+fmt(s.cost)+'</div></div>';
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  COMBAT START
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startCombat() {
  if(radarCount === 0) { addLog('li','‚ö† Place at least 1 radar before launching!'); return; }
  if(!strikePlan.length) { addLog('lm','‚ö† Add at least one strike to the plan before launching!'); return; }

  gamePhase = 'combat';
  setPhaseBadge('combat');
  show('launch-btn', false);
  document.getElementById('map-tip').classList.remove('show');
  canvas.onclick = null;
  setText('lp-hint','AUTO-INTERCEPT ACTIVE');
  setText('rp-hint','STRIKES IN FLIGHT');
  addLog('ld','‚ö° OPERATION LAUNCHED ‚Äî all systems active');

  // Spawn all bandits with staggered delays
  let delay = 800;
  strikePlan.forEach(s => {
    for(let i=0; i<s.qty; i++) {
      setTimeout(() => spawnBandit(s.type, s.axis, s.tgtIdx), delay);
      delay += 500;
    }
    delay += 1200;
  });

  // Clock (drives movement and detection)
  clockInterval = setInterval(gameTick, 1000);

  // Render loop
  function renderLoop() {
    drawMap();
    animHandle = requestAnimationFrame(renderLoop);
  }
  animHandle = requestAnimationFrame(renderLoop);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAME TICK (1/sec)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function gameTick() {
  clockSecs++;
  const m = String(Math.floor(clockSecs/60)).padStart(2,'0');
  const s = String(clockSecs%60).padStart(2,'0');
  setText('hv-clock', m+':'+s);

  moveBandits();
  detectBandits();
  checkImpacts();
  updateThreatQueue();
  checkEndGame();
}

function moveBandits() {
  activeBandits.forEach(b => {
    if(b.status === 'destroyed' || b.status === 'impact') return;
    b.x += b.nx * b.speed;
    b.y += b.ny * b.speed;
    b.trail.push({x:b.x, y:b.y});
    if(b.trail.length > 22) b.trail.shift();
    b.distRemain = Math.hypot(b.targetX - b.x, b.targetY - b.y);
  });
}

function detectBandits() {
  activeBandits.forEach(b => {
    if(b.detected || b.status === 'destroyed' || b.status === 'impact') return;
    for(const r of placedRadars) {
      const dkm = Math.hypot((b.x - r.x)*600, (b.y - r.y)*600);
      if(dkm <= 100) {
        b.detected = true;
        b.status = 'detected';
        addLog('ld','üì° DETECTED: '+b.icon+' '+b.name+' ‚Üí '+TARGETS[b.tgtIdx].short);
        // Schedule auto-intercept on next tick
        b.interceptPending = true;
        break;
      }
    }
    if(b.interceptPending) {
      b.interceptPending = false;
      setTimeout(() => tryAutoIntercept(b), 600);
    }
  });
}

function checkImpacts() {
  activeBandits.forEach(b => {
    if(b.status === 'destroyed' || b.status === 'impact') return;
    if(b.distRemain < 0.020) {
      b.status = 'impact';
      targetsAlive[b.tgtIdx] = false;
      explosions.push({x:b.targetX, y:b.targetY, r:0, maxR:0.065, alpha:1.0, big:true});
      addLog('li','üí• IMPACT! '+b.name+' HIT '+TARGETS[b.tgtIdx].short+'!');
      const alive = targetsAlive.filter(Boolean).length;
      setText('hv-targets', alive+' / 5');
    }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUTO-INTERCEPT AI ‚Äî cheapest viable asset first
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function tryAutoIntercept(b) {
  if(b.status === 'destroyed' || b.status === 'impact') return;
  if(b.intercepting) return; // already being handled
  b.intercepting = true;

  const candidates = placedAssets.filter(pa => {
    if(pa.ammo <= 0) return false;
    const dkm = Math.hypot((b.x - pa.x)*600, (b.y - pa.y)*600);
    if(dkm > pa.range) return false;
    return (pa.hitProb[b.type] || 0) >= 0.05;
  }).sort((a, z) => a.costShot - z.costShot); // cheapest first

  if(!candidates.length) {
    addLog('lm','‚ö† No asset in range for '+b.name+' ‚Äî uninterceptable!');
    b.intercepting = false;
    return;
  }

  fireAt(b, candidates, 0);
}

function fireAt(b, candidates, attempt) {
  if(b.status === 'destroyed' || b.status === 'impact') return;
  if(attempt >= candidates.length) {
    addLog('lm','‚ö† All candidates exhausted for '+b.name);
    b.intercepting = false;
    return;
  }

  const pa = candidates[attempt];
  if(pa.ammo <= 0) { fireAt(b, candidates, attempt+1); return; }

  pa.ammo--;
  defCostFired += pa.costShot;
  updateDefBudgetDisplay();
  missileLines.push({x1:pa.x, y1:pa.y, x2:b.x, y2:b.y, alpha:1.0});
  b.status = 'engaged';
  addLog('lh','üéØ '+pa.icon+' '+pa.name+' fires at '+b.name+' ($'+fmt(pa.costShot)+')');

  const prob = pa.hitProb[b.type] || 0;

  setTimeout(() => {
    if(b.status === 'destroyed' || b.status === 'impact') { b.intercepting=false; return; }
    if(Math.random() < prob) {
      // HIT
      b.status = 'destroyed';
      b.intercepting = false;
      const mult = b.distRemain > 0.45 ? 1.5 : b.distRemain > 0.2 ? 1.0 : 0.7;
      const pts = Math.round(b.points * mult);
      score += pts;
      setText('hv-score', score.toLocaleString());
      explosions.push({x:b.x, y:b.y, r:0, maxR:0.030, alpha:1.0, big:b.type==='kinzhal'});
      addLog('lh','‚úÖ HIT! '+b.name+' destroyed (+'+pts+' pts)');
    } else {
      // MISS ‚Äî try next candidate
      b.status = 'detected';
      addLog('lm','‚ùå MISS ‚Äî '+pa.name+' failed on '+b.name+'. Trying fallback...');
      b.intercepting = false;
      setTimeout(() => fireAt(b, candidates, attempt+1), 500);
    }
    updateThreatQueue();
  }, 900);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPAWN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function spawnBandit(type, axis, tgtIdx) {
  if(gamePhase !== 'combat') return;
  const ax = AXES[axis];
  const tgt = TARGETS[tgtIdx];
  const w = STRIKE_WEAPONS[type];
  const sx = ax.x + (Math.random()-0.5)*0.07;
  const sy = ax.y + (Math.random()-0.5)*0.07;
  const dx = tgt.x - sx, dy = tgt.y - sy;
  const dist = Math.hypot(dx, dy);
  const id = 'B'+(banditSeq++);
  activeBandits.push({
    id, type, axis, tgtIdx,
    x:sx, y:sy, targetX:tgt.x, targetY:tgt.y,
    nx:dx/dist, ny:dy/dist,
    speed: w.speedPerTick,
    col: w.col, icon: w.icon,
    name: w.name+'-'+id,
    points: w.points,
    status:'flying',
    detected:false, interceptPending:false, intercepting:false,
    trail:[], distRemain:dist,
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  END GAME CHECK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkEndGame() {
  if(gamePhase !== 'combat') return;
  const totalExpected = strikePlan.reduce((a,s) => a+s.qty, 0);
  if(activeBandits.length < totalExpected) return; // not all spawned yet
  const allSettled = activeBandits.every(b => b.status==='destroyed' || b.status==='impact');
  if(!allSettled) return;
  endGame();
}

function endGame() {
  gamePhase = 'end';
  clearInterval(clockInterval); clockInterval = null;
  cancelAnimationFrame(animHandle); animHandle = null;
  setPhaseBadge('end');
  setTimeout(showResults, 1800);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  THREAT QUEUE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateThreatQueue() {
  const el = document.getElementById('threat-queue');
  const vis = activeBandits.filter(b => b.status !== 'flying');
  if(!vis.length) {
    el.innerHTML='<div style="padding:14px;color:var(--dim);font-size:10px;text-align:center;">Scanning...</div>';
    return;
  }
  const sorted = [...vis].sort((a,b) => a.distRemain - b.distRemain);
  el.innerHTML = sorted.map(b => {
    const eta = b.speed > 0 ? Math.round(b.distRemain / b.speed) : 999;
    const pr = b.type==='kinzhal'||b.type==='iskander' ? 'tq-hi'
              : b.type==='cruise' ? 'tq-md' : 'tq-lo';
    const done = b.status==='destroyed'||b.status==='impact';
    const etaCls = eta<30?''  : eta<90?'mid':'far';
    const stMap = {
      detected:'<span class="tq-st st-det">‚ö† DETECTED</span>',
      engaged: '<span class="tq-st st-eng">üéØ ENGAGED</span>',
      destroyed:'<span class="tq-st st-hit">‚úÖ DESTROYED</span>',
      impact:  '<span class="tq-st st-imp">üí• IMPACT</span>',
    };
    return '<div class="tq-item '+pr+(done?' tq-done':'')+'"><div class="tq-name">'+b.icon+' '+b.name+'</div>'
      +'<div class="tq-tgt">‚Üí '+TARGETS[b.tgtIdx].short+'</div>'
      +'<div class="tq-eta '+etaCls+'">'+(eta>998?'‚Äî':eta+'s')+'</div>'
      +(stMap[b.status]||'')+'</div>';
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  RESULTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showResults() {
  const alive    = targetsAlive.filter(Boolean).length;
  const total    = activeBandits.length;
  const killed   = activeBandits.filter(b => b.status==='destroyed').length;
  const pct      = total>0 ? Math.round(killed/total*100) : 100;
  const underBud = defCostFired <= DEF_BUDGET;
  const timeBon  = clockSecs <= 900;
  let finalScore = score;
  if(timeBon && alive >= 3) finalScore = Math.round(finalScore * 1.2);

  let rank = 'F';
  if(alive >= 4 && underBud && pct >= 80) rank = 'S';
  else if(alive >= 3 && underBud && pct >= 65) rank = 'A';
  else if(alive >= 3 && pct >= 50) rank = 'B';

  const costDiff = strikeCostTotal - defCostFired;
  const efficient = costDiff >= 0;

  showScreen('result-screen');
  const rk = document.getElementById('res-rank');
  rk.textContent = rank;
  rk.className = 'res-rank rk-'+rank.toLowerCase();
  setText('res-sub',
    rank==='S'?'BLACKOUT PREVENTED ‚Äî DECISIVE VICTORY':
    rank==='A'?'GRID PROTECTED ‚Äî TACTICAL WIN':
    rank==='B'?'PARTIAL FAILURE ‚Äî PYRRHIC DEFENSE':
    'BLACKOUT ‚Äî UKRAINE LOSES POWER');

  document.getElementById('res-grid').innerHTML =
    resCard('FINAL SCORE', finalScore.toLocaleString(), rank!=='F'?'good':'bad')
    +resCard('TARGETS SURVIVED', alive+' / 5', alive>=3?'good':'bad')
    +resCard('THREATS DESTROYED', pct+'%', pct>=70?'good':pct>=50?'ok':'bad')
    +resCard('DEFENSE COST', '$'+fmt(defCostFired), underBud?'good':'bad')
    +resCard('ENEMY STRIKE COST', '$'+fmt(strikeCostTotal), '')
    +resCard('COST RESULT', efficient?'UKRAINE WINS':'RUSSIA WINS ECONOMICS', efficient?'good':'bad');

  document.getElementById('res-cmp').innerHTML =
    '<div class="rcp-title">üí∞ COST BREAKDOWN ‚Äî UKRAINE vs RUSSIA</div>'
    +cmpRow('Russia paid to launch strikes', '<span class="rcp-ru">$'+fmt(strikeCostTotal)+'</span>')
    +cmpRow('Ukraine paid to intercept', '<span class="rcp-ua">$'+fmt(defCostFired)+'</span>')
    +cmpRow('Defense budget remaining', '<span class="rcp-ua">$'+fmt(Math.max(0,DEF_BUDGET-defCostFired))+'</span>')
    +cmpRow('Threats intercepted', '<span class="'+(pct>=70?'rcp-ua':'rcp-ru')+'">'+killed+' / '+total+' ('+pct+'%)</span>')
    +cmpRow('Time bonus', '<span class="'+(timeBon?'rcp-ua':'rcp-ru')+'">'+(timeBon?'+20% score':'none')+'</span>')
    +cmpRow('<strong>Net economic outcome</strong>',
      '<strong style="color:'+(costDiff>=0?'var(--green)':'var(--red)')+';">'
      +(costDiff>=0?'Ukraine saved $'+fmt(costDiff):'Russia extracted $'+fmt(-costDiff)+' advantage')
      +'</strong>');
}
function resCard(lbl,val,cls){return '<div class="res-card"><div class="rc-lbl">'+lbl+'</div><div class="rc-val '+cls+'">'+val+'</div></div>';}
function cmpRow(lbl,val){return '<div class="rcp-row"><span class="rcp-lbl">'+lbl+'</span>'+val+'</div>';}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DRAWING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function drawMap() {
  if(!ctx) return;
  ctx.clearRect(0,0,CW,CH);

  // Background
  ctx.fillStyle='#020905'; ctx.fillRect(0,0,CW,CH);

  // Grid
  ctx.strokeStyle='rgba(0,255,136,0.035)'; ctx.lineWidth=1;
  for(let i=0;i<=30;i++){
    ctx.beginPath();ctx.moveTo(i*CW/30,0);ctx.lineTo(i*CW/30,CH);ctx.stroke();
    ctx.beginPath();ctx.moveTo(0,i*CH/30);ctx.lineTo(CW,i*CH/30);ctx.stroke();
  }

  // Ukraine silhouette
  const border=[
    [0.14,0.10],[0.22,0.04],[0.36,0.01],[0.52,0.02],[0.66,0.06],[0.78,0.12],
    [0.90,0.20],[0.98,0.30],[1.00,0.42],[0.96,0.54],[0.88,0.63],[0.80,0.72],
    [0.70,0.80],[0.58,0.88],[0.48,0.94],[0.38,0.96],[0.28,0.92],[0.18,0.84],
    [0.10,0.74],[0.05,0.62],[0.03,0.48],[0.06,0.34],[0.10,0.22],[0.14,0.10]
  ];
  ctx.strokeStyle='rgba(0,255,136,0.10)'; ctx.lineWidth=1.5;
  ctx.beginPath();
  border.forEach(([x,y],i)=>{ if(i===0)ctx.moveTo(x*CW,y*CH); else ctx.lineTo(x*CW,y*CH); });
  ctx.closePath(); ctx.stroke();
  ctx.fillStyle='rgba(0,255,136,0.018)'; ctx.fill();

  // Axis indicators
  Object.values(AXES).forEach(ax=>{
    const px=Math.max(40,Math.min(CW-60,ax.x*CW));
    const py=Math.max(14,Math.min(CH-14,ax.y*CH));
    ctx.fillStyle=ax.col;
    ctx.font='bold 10px Share Tech Mono'; ctx.textAlign='center';
    ctx.fillText(ax.label,px,py);
    const cx=0.5*CW, cy=0.5*CH;
    const d=Math.hypot(cx-px,cy-py);
    ctx.strokeStyle=ax.col; ctx.lineWidth=1; ctx.setLineDash([4,4]);
    ctx.beginPath(); ctx.moveTo(px,py); ctx.lineTo(px+(cx-px)/d*45, py+(cy-py)/d*45); ctx.stroke();
    ctx.setLineDash([]);
  });

  // Radar coverage circles
  const sweepAngle=(Date.now()/1200)%(Math.PI*2);
  placedRadars.forEach(r=>{
    const px=r.x*CW, py=r.y*CH;
    const rad=(100/600)*CW;
    // Fill gradient
    const g=ctx.createRadialGradient(px,py,0,px,py,rad);
    g.addColorStop(0,'rgba(0,255,238,0.07)'); g.addColorStop(1,'rgba(0,255,238,0)');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(px,py,rad,0,Math.PI*2); ctx.fill();
    // Border
    ctx.strokeStyle='rgba(0,255,238,0.14)'; ctx.lineWidth=1; ctx.setLineDash([3,5]);
    ctx.beginPath(); ctx.arc(px,py,rad,0,Math.PI*2); ctx.stroke(); ctx.setLineDash([]);
    // Sweep beam
    ctx.strokeStyle='rgba(0,255,238,0.30)'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(px,py); ctx.arc(px,py,rad,sweepAngle,sweepAngle+0.38); ctx.stroke();
    // Icon
    ctx.font='13px serif'; ctx.textAlign='center'; ctx.fillText('üì°',px,py+5);
  });

  // Hover preview
  if(selectedTool && hoverXY) {
    const px=hoverXY.x*CW, py=hoverXY.y*CH;
    const r=(selectedTool==='radar'?100:DEF_ASSETS[selectedTool].range)/600*CW;
    ctx.strokeStyle=selectedTool==='radar'?'rgba(0,255,238,0.45)':'rgba(0,170,255,0.40)';
    ctx.lineWidth=1; ctx.setLineDash([3,4]);
    ctx.beginPath(); ctx.arc(px,py,r,0,Math.PI*2); ctx.stroke(); ctx.setLineDash([]);
  }

  // Asset range rings + icons
  placedAssets.forEach(pa=>{
    const px=pa.x*CW, py=pa.y*CH;
    const rad=(pa.range/600)*CW;
    ctx.strokeStyle='rgba(0,170,255,0.09)'; ctx.lineWidth=1; ctx.setLineDash([2,5]);
    ctx.beginPath(); ctx.arc(px,py,rad,0,Math.PI*2); ctx.stroke(); ctx.setLineDash([]);
    ctx.font='15px serif'; ctx.textAlign='center'; ctx.fillText(pa.icon,px,py+5);
    ctx.fillStyle='rgba(200,232,208,0.45)'; ctx.font='8px Share Tech Mono';
    ctx.fillText(pa.name.slice(0,12),px,py+18);
  });

  // Intercept missile lines
  missileLines = missileLines.filter(l=>l.alpha>0);
  missileLines.forEach(l=>{
    ctx.strokeStyle='rgba(0,170,255,'+l.alpha+')'; ctx.lineWidth=1; ctx.setLineDash([3,3]);
    ctx.beginPath(); ctx.moveTo(l.x1*CW,l.y1*CH); ctx.lineTo(l.x2*CW,l.y2*CH); ctx.stroke();
    ctx.setLineDash([]); l.alpha -= 0.05;
  });

  // Targets
  TARGETS.forEach((t,i)=>{
    const px=t.x*CW, py=t.y*CH;
    const alive=targetsAlive[i];
    ctx.globalAlpha=alive?1.0:0.20;
    ctx.font='20px serif'; ctx.textAlign='center'; ctx.fillText('‚ö°',px,py+7);
    ctx.globalAlpha=1;
    ctx.fillStyle=alive?'#00ff88':'#ff3344';
    ctx.font='bold 9px Share Tech Mono'; ctx.textAlign='center';
    ctx.fillText(t.short,px,py+22);
    if(alive){
      const pulse=(Math.sin(Date.now()/850)+1)*0.5;
      ctx.strokeStyle='rgba(0,255,136,'+(pulse*0.28)+')'; ctx.lineWidth=1.5;
      ctx.beginPath(); ctx.arc(px,py,15+pulse*5,0,Math.PI*2); ctx.stroke();
    }
  });

  // Bandits (only if detected)
  activeBandits.forEach(b=>{
    if(b.status==='destroyed'||b.status==='impact') return;
    if(!b.detected) return;
    const px=b.x*CW, py=b.y*CH;
    // Trail
    if(b.trail.length>1){
      ctx.globalAlpha=0.18; ctx.strokeStyle=b.col; ctx.lineWidth=1.2;
      ctx.beginPath();
      b.trail.forEach((p,i)=>{ if(i===0)ctx.moveTo(p.x*CW,p.y*CH); else ctx.lineTo(p.x*CW,p.y*CH); });
      ctx.stroke(); ctx.globalAlpha=1;
    }
    // Dot with glow
    const sz=b.type==='kinzhal'?7:b.type==='iskander'?6:4;
    ctx.shadowColor=b.col; ctx.shadowBlur=b.type==='kinzhal'?16:7;
    ctx.fillStyle=b.col; ctx.beginPath(); ctx.arc(px,py,sz,0,Math.PI*2); ctx.fill();
    ctx.shadowBlur=0;
    // Label
    ctx.fillStyle='rgba(255,255,255,0.75)'; ctx.font='8px Share Tech Mono'; ctx.textAlign='left';
    ctx.fillText(b.name,px+9,py+3);
    // Projected path
    ctx.globalAlpha=0.10; ctx.strokeStyle=b.col; ctx.lineWidth=1; ctx.setLineDash([2,4]);
    ctx.beginPath(); ctx.moveTo(px,py); ctx.lineTo(b.targetX*CW,b.targetY*CH); ctx.stroke();
    ctx.setLineDash([]); ctx.globalAlpha=1;
  });

  // Explosions
  explosions = explosions.filter(e=>e.alpha>0);
  explosions.forEach(e=>{
    const px=e.x*CW, py=e.y*CH;
    e.r += e.big ? 0.005 : 0.004;
    e.alpha -= 0.025;
    const col=e.big?'255,80,40':'255,210,60';
    const g=ctx.createRadialGradient(px,py,0,px,py,e.r*CW);
    g.addColorStop(0,'rgba('+col+','+e.alpha+')');
    g.addColorStop(1,'rgba('+col+',0)');
    ctx.fillStyle=g; ctx.beginPath(); ctx.arc(px,py,e.r*CW,0,Math.PI*2); ctx.fill();
  });

  ctx.textAlign='left';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setPhaseBadge(p){
  const el=document.getElementById('phase-badge');
  el.className='phase-badge '+(p==='setup'?'ph-setup':p==='combat'?'ph-combat':'ph-end');
  el.textContent=p==='setup'?'SETUP PHASE':p==='combat'?'‚ö° COMBAT ACTIVE':'OPERATION COMPLETE';
}
function updateDefBudgetDisplay(){
  const rem=Math.max(0,DEF_BUDGET-defCostFired);
  setText('hv-defbud','$'+fmt(rem));
  const el=document.getElementById('hv-defbud');
  el.className='hv '+(rem<30e6?'rd':'am');
  const pct=(rem/DEF_BUDGET)*100;
  const fill=document.getElementById('bb-fill');
  fill.style.width=pct+'%';
  fill.className='bb-fill'+(pct<20?' over':pct<40?' warn':'');
  setText('bb-spent','$'+fmt(defCostFired)+' / $150M used');
}
function fmt(n){
  if(n>=1e9)return(n/1e9).toFixed(2)+'B';
  if(n>=1e6)return(n/1e6).toFixed(2)+'M';
  if(n>=1e3)return(n/1e3).toFixed(0)+'K';
  return Math.round(n).toString();
}
function setText(id,t){const e=document.getElementById(id);if(e)e.textContent=t;}
function setClass(id,c){const e=document.getElementById(id);if(e)e.className=c;}
function setStyle(id,p,v){const e=document.getElementById(id);if(e)e.style[p]=v;}
function show(id,vis){const e=document.getElementById(id);if(e)e.style.display=vis?'':'none';}
function clearLog(){const e=document.getElementById('blog');if(e)e.innerHTML='';}
function addLog(cls,msg){
  const m=String(Math.floor(clockSecs/60)).padStart(2,'0');
  const s=String(clockSecs%60).padStart(2,'0');
  const d=document.getElementById('blog');
  if(!d) return;
  const div=document.createElement('div'); div.className='log-e';
  div.innerHTML='<span class="lt">['+m+':'+s+']</span><span class="'+cls+'">'+msg+'</span>';
  d.appendChild(div); d.scrollTop=d.scrollHeight;
}
document.addEventListener('contextmenu',e=>e.preventDefault());
</script>
</body>
</html>
